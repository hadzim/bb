<!DOCTYPE html>
<!-- saved from url=(0062)https://192.168.99.112/remote-control_device-control_live-demo -->
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">		
    <title>Josefuv dul</title>		
    <script src="js/jquery.js" ></script>    
    <script src="js/bootstrap.js" type="text/javascript"></script>    
    <script src="js/Visualization.js" type="text/javascript"></script>
    <script src="js/Chart.js" type="text/javascript"></script>    
    <link rel="stylesheet" href="css/bootstrap.css" type="text/css">     	
  </head>  
  <body>
  <style type="text/css">
  <!--
  .icon {
      font-size: 5.5em;
      color: rgba(255,255,255,0.6);
      text-shadow: 1px -1px 8px #fff;
      font-weight: bold;
  }
  h3.icon {
      position: absolute;
      margin-top: 13px;
      margin-left: 0px;
      z-index: 0;
   }
   
   div.iconable {
      position: relative;
       padding-left: 100px;
       z-index: 5;
       padding-top: 15px;
       border-top: 2px solid #444;
   }
   
   div#date {
    margin-top: -10px;
      
   }
   div#date div {
      /*position: absolute;
      top: 0px;*/
      float: left;
      font-weight: bold;
   }
   
   div#date div#dateday{
      font-size: 2.2em;
      width: 50%;
   }
   div#date div#datedate{
      font-size: 2.2em;
      width: 50%;
   }
   
   div#date div#datetime {
      line-height: 1em;
      font-size: 6.5em;
      width: 43%;
      color: rgba(255,255,255,0.7);
      text-shadow: 1px -1px 4px #fff;
      
   }
   
   #box { 
      width: 780px; 
      height: 460px; 
      margin: 0px; padding: 0px;
      background-color: #000;
      color: white;
      position: relative;
   }
   .btn {
      color: black;
   }
   .btn-primary {
      color: white;
   }
   
   #inbox { 
    padding: 10px;
    font-size: 1.0em;
   }
   
   
   
   
   #box hr {
   border: 0px;
    border-bottom: 2px solid rgba(255,255,255,0.3);
    line-height: 2px;
    margin: 10px 0px;
    padding: 0px;  
   }
   
   #forecasts {
      /*margin-left: 30px;*/
   }
   
   #forecastsnav {
      /*position: absolute;
      width: 100px;*/
   }
   
   .forecast {
    float: left;
    margin: 5px 7px 5px 0px;
   }
   .forecast {
      padding-left: 3px;
      padding-right: 3px;
   }
   .forecast .btn {
    margin: 1px;
    padding-left: 4px;
    padding-right: 4px;
   }
   
   
   
   .inline {
    display: inline;
   }
   .modal-content {
      background-color: black;
      color: white;
      border-color: white;
   }
   /*
   .modal {
      border: 1px solid white;
      background-color: rgba(0,0,0,0.9) !important;
   } */
   .close-inverse {
      color: white;
      opacity: 0.7;
   }
   .close-inverse:hover, .close-inverse:focus {
      color: #fff;
      opacity: 0.9;
      filter: alpha(opacity=40);
    }
    
    button.fcoverview {
      margin: 5px -1px 2px;
    }
    .temperatureGraph {
        position: absolute;
        right: 20px;
        margin-top: -50px;
    }
    div#temperature {
        height: 90px;
    }
    div#temperature .btn {
      float: left;
      margin: 5px 10px 0px 0px;
    }
    .bigtemp {
      min-width: 210px;
      font-size: 2.0em;
      background-color: transparent;
      color: white;
      border: 0px;
    }
    .normaltemp {
      min-width: 110px;
    }
    .bigtemp .temp {
      font-size: 2.5em;
      line-height: 1.0em;
      padding: 0px 0px 0px 0.2em;
      font-weight: bold;
   } 
   .temp-under {
      color: rgb(124, 159, 211);
   }
   
   .temp-above {
      
   }
   #temperatureChart {
      margin-left: 100px;
      margin-top: 10px;
   }
   
    
  //-->
  </style>
    <div id='box'>
      <div id='inbox'>
          <h3 class='icon'><span class="glyphicon glyphicon-time"></span></h3>
          <div id='date' class='iconable clearfix'>
            <div id='datetime'>14:45</div>
            <div id='datedate'>15. Července</div>
            <div id='dateday'>Pondělí</div>
          </div>
           
           
           <h3 class='icon'><span class="glyphicon glyphicon-stats"></span></h3>
           
           
           
           <div class='iconable clearfix'>
           <div id='temperature'>
            
          </div> 
          </div>
                     
          <h3 class='icon'><span class="glyphicon glyphicon-cloud"></span></h3>
          
          
          
          <div class='iconable clearfix'>
            
         <script type="text/javascript">
          
          
            var temperatureSensors = {
                "Inside": {
                  name: "uvnitř",
                  css: "bigtemp", //btn-warning
                  temp: undefined
                },
                "Outside": {
                  name: "venku",
                  css: "bigtemp", //btn-info
                  temp: undefined
                },
                "Hall": {
                  name: "chodba",
                  css: "normaltemp",
                  temp: undefined
                },
                "Heating": {
                  name: "kotel",
                  css: "normaltemp btn-danger",
                  temp: undefined
                }
            }
            
            function renderTemperature(key){
                 var content = "<button rel='temper' data-place='" + key + "' class='btn btn-default " + temperatureSensors[key].css + "'>"; 
                 content += temperatureSensors[key].name;
                 content += ": ";
                 content += (temperatureSensors[key].temp > 0 ? "<span class='temp temp-above'>" : "<span class='temp temp-under'>");
                 content += (temperatureSensors[key].temp == undefined) ? "?" : temperatureSensors[key].temp | 0;
                 content += "</span>&deg;C";
                 content += "</button>";
                return content;     
            }
            function renderTemperatures(){
                var c = "";
                $.each(temperatureSensors, function( findex, fvalue ) {
                  c += renderTemperature(findex);
                });
                $("#temperature").html(c);
            }
          
            function updateTemperatures(){
                  
                  console.log("Get temperature: ");
               
                  var si = tbsService.GetSensorsData("Temperature");
                  si.done(function( data, tempTextStatus, forecastJqXHR ) {
                    console.log(data);
                    $.each(data.ReturnObject, function( findex, fvalue ) {
                          
                        if(temperatureSensors.hasOwnProperty(fvalue.sensorName)){
                           temperatureSensors[fvalue.sensorName].temp = fvalue.value;
                        }
                    }); 
                    
                    renderTemperatures();
                    console.log("Get temperatures: ", " done");     
                  });
               
            }
          
            
            
            //initChart();
          
            var tbsService;
            
            var dayNamesShort = new Array("Ne", "Po", "Út", "St", "Čt", "Pá", "So");
            var dayNamesLong = new Array("Neděle", "Pondělí", "Úterý", "Středa", "Čtvrtek", "Pátek", "Sobota");
            var monthNames = new Array("Leden", "Únor", "Březen", "Duben", "Květen", "Červen", "Červenec", "Srpen", "Září", "Říjen", "Listopad", "Prosinec");
            
                                 
            function daydiff(first, second) {
                return (second-first)/(1000*60*60*24);
            }
            
            
            
            function forecastData(rawData){
                var dn = new Date();
                var d = new Date(rawData.date);
                
                var obj = new Object();
                
                obj.date = dayNamesShort[d.getDay()] + " " + d.getDate().toString() + "." + d.getMonth().toString() + ".";
                obj.hour = d.getHours();
                obj.temperature = rawData.value;
                obj.datediff = daydiff(dn, d);
                //console.log(obj);
                $.each(rawData.textValue.split(";"), function( findex, fvalue ) {
                     var name = fvalue.split(":")[0];
                     var val = fvalue.split(":")[1];
                     
                     if (name == "n"){
                     
                        obj.name = val; 
                     }
                     if (name == "p"){
                        obj.percipation = val; 
                     }
                     if (name == "w"){
                        obj.wind = val; 
                     }
                     if (name == "i"){
                        obj.img = "img/weather/" + (obj.hour > 6 && obj.hour < 20 ? "day" : "night") + "/" + val + ".png"; 
                     }
                     
                });
                return obj;
            }
            
            function renderSmallForecastWidget(fdata){
                var str = "";
                str += "<button class='btn btn-default fcoverview'>";
                str += "<span class='time'>" + fdata.hour + ":00</span><br />";
                str += "<span class='img'><img src='" + fdata.img + "'></span><br />";
                str += "<span class='temp'>" + fdata.temperature + "&deg;C</span><br />";  
                str += "</button>";
                return str;
            }
            function renderBigForecastWidget(data){
            
            }
            
            function pad(num) {
              return ("0"+num).slice(-2);
            }
            
            function readableTime(dn){
                return pad(dn.getHours())+":"+pad(dn.getMinutes());
            }
            
            var temperatureRefresh = 0;
            
            function updateTime(){
                 var dn = new Date();
                 $("#datetime").html(readableTime(dn));
                 $("#dateday").html(dayNamesLong[dn.getDay()]);
                 $("#datedate").html(dn.getDate().toString() + ". " + monthNames[dn.getMonth()]);
                 
                 if (temperatureRefresh++ > 60){
                    temperatureRefresh = 0;
                    updateTemperatures();
                 }
            }
            
            function updateForecastJson(item, sensorType, sensorName){
               //get DATA
               var sidata = tbsService.GetSensorData(sensorType, sensorName);
               sidata.done(function( data, forecastTextStatus, forecastJqXHR ) { 
                    var days = new Object();
                    var daysDiff = new Object();
                    $.each(data.ReturnObject, function( findex, fvalue ) {
                        var fdata = forecastData(fvalue);
                        //if (fdata.hour == 7 || fdata.hour == 13 || fdata.hour == 19){
                          if (!(fdata.date in days)){
                              days[fdata.date] = new Object();
                              daysDiff[fdata.date] = fdata.datediff;  
                          }
                          var hh = fdata.hour.toString();
                          days[fdata.date][hh] = fdata;
                        //}
                    }); 
                    
                    var content = "";
                    $.each( days, function( key, hours ) {
                       if (daysDiff[key] < 0 || daysDiff[key] > 5) return;
                       content += "<div class='btn btn-primary forecast'>";
                       content += "<div><b>" + key + "</b></div>";
                       var cnt = 0;   
                       $.each(hours, function( findex2, fdata ) {
                                if (fdata == undefined) return;
                                if (++cnt != 3 && daysDiff[key] > 1) return;
                                content += renderSmallForecastWidget(fdata); 
                      });
                      content += "</div>";
                  });
                    
                  item.html(content);
               });
            }
            
            function updateDefaultForecast(){
              updateForecast($('#forecasts'), activeForecast);
            }
            
            function showTemperatureDetail(place){
              
              //prepare data
                 
                 var sidata = tbsService.GetSensorData("Temperature", place);
                  sidata.done(function( data, tempTextStatus, forecastJqXHR ) {
                    
                    var labels = new Array();
                    var values = new Array();
                    var zerovalues = new Array();
                    
                    var len = data.ReturnObject.length;
                    var cnt = 0;
                    $.each(data.ReturnObject, function( findex, fvalue ) {
                        values.push(fvalue.value);   
                        zerovalues.push(0);         
                        if (len < 10 || (cnt++) % 3 == 0){
                          labels.push(readableTime(new Date(fvalue.date)));
                        } else {
                          labels.push("");
                        }
                    }); 
                    
                          //Get context with jQuery - using jQuery's .get() method.
                      var ctx = $("#temperatureChart").get(0).getContext("2d");
                      //This will get the first returned node in the jQuery collection.
                      var myNewChart = new Chart(ctx);
                  
                      var data = {
                        labels: labels,
                      	datasets : [
                      		{
                            fillColor : "rgba(200,200,200,0.0)",
                      			strokeColor : "rgba(200,220,220,1)",
                      			pointColor : "rgba(200,255,255,1)",
                      			pointStrokeColor : "#aaf",
                      			data : zerovalues
                      		},
                          {
                      			fillColor : "rgba(200,200,200,0.3)",
                      			strokeColor : "rgba(220,220,220,1)",
                      			pointColor : "rgba(255,200,200,1)",
                      			pointStrokeColor : "#fff",
                      			data : values
                      		},
                          
                      	]
                      }
                      var opts = {
                        	animation : false,  
                          scaleFontColor : "#eee",
                          pointDotRadius : 2,
                          datasetStrokeWidth : 1,
                          scaleGridLineColor : "rgba(255,255,255,.2)",	
                      };
                      new Chart(ctx).Line(data, opts);   
                  });
            
              
              $("#temperatureModal").modal();
            }
            
            var activeForecast = "JosefuvDul";
            
            function updateForecast(item, name){
                  var si = tbsService.GetSensors();
                                              
                  si.done(function( data, textStatus, jqXHR ) {
                      console.log("done sensors");
                      console.log(data);
                      $.each(data.ReturnObject, function( index, value ) {
                           if (value.sensorType == "ForecastTemperature" && value.sensorName == name){
                              updateForecastJson(item, value.sensorType, value.sensorName);
                          }
                      });
                      
              		    
                  });
            }
            
            $( document ).ready(function() {
                	tbsService = new Query({url: "http://127.0.0.1:8111/"});
                  
                  window.setInterval(updateTime,1000);
                  updateTime();
                  updateDefaultForecast();
                	
                  updateTemperatures();
                  
                  $("button[rel='fcb']").click(function(){
                        $("button[rel='fcb']").removeClass("btn-primary");
                        $(this).addClass("btn-primary");
                        //updateForecast($('#forecasts'), $(this).attr("data-place"));
                        activeForecast = $(this).attr("data-place");
                        updateDefaultForecast();
                  });
                  
                  $("#temperature").on("click", "button", function(e){
                        
                        showTemperatureDetail($(this).attr("data-place"));
                  });
                  
                  
                  $('button.fcoverview').click(function(){
                      $('#mymodal').modal();
                      //$('#box').modal("ahoj");
                  });
                  
          
          	});
          
         </script>
         
         <div id='forecastsnav'>
         <button rel='fcb' data-place="JosefuvDul" class='btn btn-default' />Josefův Důl</button>
         <button rel='fcb' data-place="Kristianov" class='btn btn-default' />Kristiánov</button>
         <button rel='fcb' data-place="Smedava" class='btn btn-default' />Smědava</button>
         <button rel='fcb' data-place="Jizerka" class='btn btn-default' />Jizerka</button>
          </div>         
         <div id='forecasts'>
           
          
            <div class='btn forecast'>
              <div><b>Ut 14.7.</b></div>
              <button class='btn btn-inverse'>08:00<br />-2&deg;C<br /> </button>
              <button class='btn btn-inverse'>12:00<br />-2&deg;C<br /> </button>
            </div>
            
         </div>
         </div>
            		 
    </div>
    
    <div class="modal hide fade" id='mymodal'>
      <div class="modal-header">
        <button type="button" class="close close-inverse" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3  id='mymodalHeader'>Předpověď</h3>
      </div>
      <div class="modal-body">
         <div class='mybtn mybtn-violet forecast forecast-detail'>
              <div><b>Po 13.7.</b></div>
              <button class='mybtn mybtn-blue leftaligned' rel='10;15;silny;-2;'>
                  čas: 08:00<br />
                  teplota: -2&deg;C<br /> 
                  obrázek: <img src="http://symbol.yr.no/grafikk/sym/b38/09.png" /><br />
                  vítr: 6 m/s<br />
                  srážky: 12 mm<br />
              </button>
              <button class='mybtn mybtn-blue'>12:00<br /><span class='temp-above'>2&deg;C<span><br /> </button>
              <button class='mybtn mybtn-blue'>16:00<br /><span class='temp-under'>+2&deg;C<span><br /> </button>    
            </div>
      </div>
    </div>
    
    
<div class="modal fade" id="temperatureModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
          <button type="button" class="close close-inverse" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h3 class='icon'><span class="glyphicon glyphicon-stats"></span></h3>
          <canvas id="temperatureChart" width="450" height="250"></canvas>
      </div>
      
    </div>
  </div>
</div>
    
  </body>
</html>